"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const execaWrapper_1 = require("./execaWrapper");
const selectPortMapping_1 = require("./selectPortMapping");
exports.createDefaultReadinessChecks = ({ runner, runner: { containerId, dockerComposeFileService: { ports }, }, }) => ({
    postgres: async ({ POSTGRES_DB, POSTGRES_USER }) => {
        // Ref: http://postgresguide.com/utilities/psql.html
        const command = `docker exec ${containerId} bash -c " \
                        psql \
                        -h localhost \
                        -d ${POSTGRES_DB} \
                        -U ${POSTGRES_USER} \
                        -c 'select 1'"`;
        await execaWrapper_1.execaWrapper(command, { runner });
    },
    redis: async () => {
        const command = `docker exec ${containerId} redis-cli \
                        -h localhost \
                        -p ${selectPortMapping_1.selectPortMapping(ports[0]).target} \
                        PING`;
        await execaWrapper_1.execaWrapper(command, { runner });
    },
    web: async (port = 3000) => {
        const command = `docker exec ${containerId} \
                        sh -c "wget --quiet --tries=1 --spider http://localhost:${port}/.well-known/healthcheck"`;
        await execaWrapper_1.execaWrapper(command, { runner });
    },
});
//# sourceMappingURL=createDefaultReadinessChecks.js.map